<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account - Tony & Remo's</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,700;1,400&family=Poppins:wght@300;400;600;700;800;900&family=Roboto:ital,wght@0,500;0,700;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="modernNormalize.css" />
    <link rel="stylesheet" href="general.css" />
    <link rel="stylesheet" href="homepage-barber.css" />
    <link rel="stylesheet" href="sectionServizi.css" />
    <link rel="stylesheet" href="contactsSection.css" />
    <link rel="stylesheet" href="utility.css" />
    <style>
      /* Aggiungi qui i tuoi stili personalizzati */
      /* Aggiungi qui i tuoi stili personalizzati */
      .html {
        scroll-behavior: smooth;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: black; /* Cambiato colore di sfondo */
        color: #333;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }

      .container {
        max-width: 800px;
        margin: 50px auto;
        padding: 30px;
        border-radius: 10px;
        /*box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Aggiunto box-shadow */
      }
      /*.container:hover {
        box-shadow: 0 4px 6px rgba(255, 255, 255, 0.6);
      }*/

      .account-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .account-header h1 {
        font-size: 2.5rem;
        font-weight: bold;
        color: white;
      }

      .account-info p {
        font-size: 1.2rem;
        margin-bottom: 10px;
        color: rgb(121, 117, 117); /* Cambiato colore del testo */
      }
      .titoloRicerca {
        color: white;
        font-weight: bold;
      }
      .searchBtn {
        background-color: #bd1b95;
        color: white;
        padding: 0.5rem;
      }
      .btn-primary {
        background-color: #bd1b95 !important;
        border: none;
        padding: 10px 30px;
        font-size: 1.2rem;
        border-radius: 5px;
        cursor: pointer;
        box-shadow: 0 4px 6px rgb(189, 27, 149);
      }

      .btn-primary:hover {
        background-color: #9c156f !important;
      }

      .input-group-text {
        background-color: transparent;
      }

      .input-group-append .btn {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
      }
      .detail-label {
        margin-right: 10px;
      }
      h2 {
        font-weight: bold;
        color: white;
      }
      .gap {
        gap: 1.5rem;
      }
      #results {
        max-width: 100%; /* Altezza massima del contenitore */
        overflow: auto; /* Abilita lo scrolling se la tabella è più grande del contenitore */
      }
      .search-box {
        margin-top: 2.5rem;
      }
      .white {
        color: rgb(121, 117, 117);
      }
    </style>
  </head>

  <body>
    <header>
      <nav class="navbar navbar-expand-lg">
        <h1 class="header__title navbar-brand">
          <a href="#header">Tony's & Remo's</a>
        </h1>
        <button
          class="menu-bar navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collasato collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link menu__link" href="form.html">Prenota</a>
            </li>
            <li class="nav-item">
              <a class="nav-link menu__link" href="">Contatti</a>
            </li>
            <li class="nav-item">
              <a class="nav-link menu__link" href="account-Utente.html"
                >Account</a
              >
            </li>
          </ul>
        </div>
      </nav>
    </header>

    <div class="container">
      <header class="account-header">
        <h1>Account - Tony & Remo's</h1>
      </header>

      <div class="row">
        <!-- Colonna sinistra per le informazioni dell'account -->
        <div class="col-md-6">
          <div id="accountInfoContainer"></div>
        </div>

        <!-- Colonna destra per la barra di ricerca delle prenotazioni -->
        <div class="col-md-6">
          <div class="search-container">
            <!-- Barra di ricerca delle prenotazioni -->
            <h3 class="titoloRicerca mt-1">Ricerca Appuntamenti</h3>
            <div class="search-box d-flex">
              <input
                type="text"
                id="searchInput"
                placeholder="Inserisci il servizio..."
              />
              <button
                class="searchBtn"
                id="searchButton"
                onclick="searchAppointments()"
              >
                Cerca appuntamenti
              </button>
            </div>

            <div id="results"></div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", async function () {
      const accountInfoContainer = document.getElementById(
        "accountInfoContainer"
      );
      /*async function fetchPassword() {
        try {
          console.log("Fetching password ...");
          const response = await fetch("");
          const data = await response.json();
          console.log("Data fetched successfully:", data);
          localStorage.setItem("utente", JSON.stringify(data));
          return data;
        } catch (error) {
          console.error("Error fetching account data:", error);
          return null;
        }
      }*/

      function renderAccountData() {
        let loggato = true;
        //console.log(utenteIndex);
        //console.log("sessione id utente:", utenteIndex);
        const userData = JSON.parse(localStorage.getItem("utenti"));
        console.log("Rendering account data:", userData);
        const user = userData; //getUserDataById(userData, utenteIndex);
        if (user) {
          accountInfoContainer.innerHTML = `
    <div class="account-info mb-4" id="account-info">
        <h2>Informazioni Account</h2>
        <div class="row" id="info-visible">
            <div class="col-sm-12 ao">
                <p><span class="detail-label">Email:</span> ${user.email}</p>
                <div class="input-group">
                    <div class="d-flex align-items-center mr-4">
                        <p class="detail-label  mb-0">Password:</p>
                    </div>
                    <input type="password" class="form-control ml-5" id="password" value="${user.pwd}" readonly>
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" id="password-toggle">
                            <i class="fas fa-eye" id="password-icon"></i>
                        </button>
                    </div>
                </div>
                <div class="d-flex flex-wrap gap mt-4">
                  <button class="btn btn-secondary" id="btn-logOut">Logout</button>
                  <button id="editButton" class="btn btn-secondary">Modifica</button>
              </div>
            </div>

            
        </div>
        <form id="updateAccountForm" action="aggiornaInfoUtente.php" method="post" style="display: none;">
            <div class="form-group">
                <label for="nome">Nome:</label>
                <input type="text" class="form-control" id="nome" name="nome" value="${user.nome}">
            </div>
            <div class="form-group">
                <label for="cognome">Cognome:</label>
                <input type="text" class="form-control" id="cognome" name="cognome" value="${user.cognome}">
            </div>
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" class="form-control" id="username" name="username" value="${user.username}">
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" id="email" name="email" value="${user.email}">
            </div>
            <div class="form-group">
                <label for="newPassword">Nuova Password:</label>
                <input type="password" class="form-control" id="newPassword" name="newPassword">
            </div>
            <div class="mt-4">
              <button type="submit" class="btn btn-secondary">Aggiorna</button>
              <button type="button" id="cancelButton" class="btn btn-secondary">Annulla</button>
            </div>
        </form>
    </div>`;

          const logoutBtn = document.getElementById("btn-logOut");
          const editButton = document.getElementById("editButton");
          const cancelButton = document.getElementById("cancelButton");
          const updateAccountForm =
            document.getElementById("updateAccountForm");
          editButton.addEventListener("click", function () {
            // Nascondi le informazioni dell'account e mostra il modulo di aggiornamento
            document.getElementById("info-visible").style.display = "none";
            document.getElementById("accountInfoContainer").style.display =
              "block";

            updateAccountForm.style.display = "block";
          });

          cancelButton.addEventListener("click", function () {
            // Nascondi il modulo di aggiornamento e mostra le informazioni dell'account
            setTimeout(function () {
              window.location.reload();
              updateAccountForm.style.display = "none";
              document.getElementById("accountInfoContainer").style.display =
                "block";
            }, 500);
          });

          updateAccountForm.addEventListener("submit", function (event) {
            //event.preventDefault(); // Impedisci il comportamento predefinito del modulo di aggiornamento

            // Recupera i valori dei campi del modulo
            const nome = document.getElementById("nome").value;
            const cognome = document.getElementById("cognome").value;
            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const newPassword = document.getElementById("newPassword").value;

            // Invia i dati al server per l'aggiornamento dell'account (implementa questa parte nel tuo backend)
            // Dopo aver completato con successo l'aggiornamento, puoi nascondere il modulo di aggiornamento e mostrare le informazioni dell'account aggiornate
            updateAccountForm.style.display = "none";
            document.getElementById("accountInfoContainer").style.display =
              "block";
          });
          logoutBtn.addEventListener("click", () => {
            setTimeout(function () {
              localStorage.removeItem("utenti");
              window.location.reload();
              window.location.href = "index.html";
            }, 1000);
          });
        } else {
          accountInfoContainer.innerHTML = "<p>Nessun dato trovato.</p>";
          setTimeout(() => {
            window.location.href = "login-Utente.html";
          }, 1000);
        }

        // Funzione per mostrare/nascondere la password
        function togglePasswordVisibility() {
          const passwordInput = document.getElementById("password");
          const passwordIcon = document.getElementById("password-icon");

          if (passwordInput.type === "password") {
            passwordInput.type = "text";
            passwordIcon.classList.remove("fa-eye");
            passwordIcon.classList.add("fa-eye-slash");
          } else {
            passwordInput.type = "password";
            passwordIcon.classList.remove("fa-eye-slash");
            passwordIcon.classList.add("fa-eye");
          }
        }

        // Aggiungi un gestore di eventi al clic sull'icona dell'occhio
        document
          .getElementById("password-toggle")
          .addEventListener("click", togglePasswordVisibility);
      }

      renderAccountData();
    });

    async function searchAppointments() {
      let searchInput = document.getElementById("searchInput").value;
      let utentiStringa = localStorage.getItem("utenti");
      let utenti = JSON.parse(utentiStringa);
      let email = utenti.email;
      console.log(email);
      let url = `http://127.0.0.1:8000/api/v1/users/appuntamenti/${encodeURIComponent(
        searchInput
      )}/${encodeURIComponent(email)}`;

      try {
        const response = await fetch(url);
        const data = await response.json();
        displayResults(data);
      } catch (error) {
        console.error("Errore durante la ricerca degli appuntamenti:", error);
        let resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = ""; // Pulisce i risultati precedenti
        resultsDiv.innerHTML = `<p class="white">Nessun appuntamento trovato per questo servizio.</p> `;
      }
    }

    function displayResults(data) {
      let resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = ""; // Pulisce i risultati precedenti

      if (Object.keys(data).length === 0) {
        resultsDiv.innerHTML = `<p class="white">Nessun appuntamento trovato per questo servizio.</p> `;
      } else {
        let tableHTML = `<table class="table table-striped table-bordered mt-4">
            <thead>
              <tr>
                <th>ID Appuntamento</th>
                <th>Nome</th>
                <th>Cognome</th>
                <th>Email</th>
                <th>Telefono</th>
                <th>Servizio</th>
                <th>Data</th>
                <th>Ora</th>
              </tr>
            </thead>
            <tbody>`;

        for (let id in data) {
          let appointment = data[id];
          tableHTML += `<tr>
                          <td>${appointment.id_appuntamento}</td>
                          <td>${appointment.nome}</td>
                          <td>${appointment.cognome}</td>
                          <td>${appointment.email}</td>
                          <td>${appointment.telefono}</td>
                          <td>${appointment.servizio}</td>
                          <td>${appointment.data_appuntamento}</td>
                          <td>${appointment.ora_appuntamento}</td>
                      </tr>`;
        }

        tableHTML += "</tbody></table>";
        resultsDiv.innerHTML = tableHTML;
      }
    }
  </script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</html>
